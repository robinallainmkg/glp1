<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü§ñ Test RAG GLP1-France (Embarqu√©)</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 40px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        .container { 
            background: white; 
            padding: 40px; 
            border-radius: 15px; 
            max-width: 800px; 
            margin: 0 auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
        }
        h1 { 
            color: #667eea; 
            text-align: center; 
            margin-bottom: 30px;
        }
        .test-form {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }
        input { 
            flex: 1;
            padding: 15px; 
            font-size: 16px; 
            border: 2px solid #ddd; 
            border-radius: 10px;
            outline: none;
        }
        input:focus {
            border-color: #667eea;
        }
        button { 
            padding: 15px 30px; 
            font-size: 16px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            border: none; 
            border-radius: 10px; 
            cursor: pointer;
            font-weight: 500;
        }
        button:hover { 
            transform: translateY(-2px);
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .examples {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        .example {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid #e9ecef;
            text-align: center;
        }
        .example:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }
        .result { 
            margin-top: 30px; 
            padding: 25px; 
            border-radius: 15px;
            line-height: 1.6;
        }
        .loading { 
            background: #e3f2fd;
            color: #1976d2;
            text-align: center; 
        }
        .error { 
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #f44336;
        }
        .success { 
            background: #e8f5e8;
            color: #2e7d32;
            border-left: 4px solid #4caf50;
        }
        .answer {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 10px;
        }
        .sources {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
        }
        .source-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 3px solid #667eea;
        }
        .similarity {
            background: #e9ecef;
            padding: 4px 8px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bold;
            float: right;
        }
        .status {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: bold;
        }
        .status.ready {
            background: #d4edda;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        .info {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #2196f3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ Test RAG GLP1-France</h1>
        
        <div class="info">
            <h3>‚ÑπÔ∏è Version Embarqu√©e - 100% Fonctionnelle</h3>
            <p>Cette version contient les donn√©es directement dans la page et fonctionne sans serveur.</p>
        </div>
        
        <div id="status" class="status ready">‚úÖ Base de connaissances charg√©e</div>
        
        <div class="test-form">
            <input type="text" id="query" placeholder="Posez votre question sur GLP1..." value="Qu'est-ce que GLP1 ?">
            <button onclick="testRAG()" id="testBtn">Tester</button>
        </div>
        
        <div class="examples">
            <div class="example" onclick="setQuery('Qu&apos;est-ce que GLP1 ?')">
                Qu'est-ce que GLP1 ?
            </div>
            <div class="example" onclick="setQuery('Comment fonctionne GLP1 ?')">
                Comment √ßa fonctionne ?
            </div>
            <div class="example" onclick="setQuery('Ozempic pour perdre du poids')">
                Ozempic perte de poids
            </div>
            <div class="example" onclick="setQuery('Prix en France')">
                Prix en France
            </div>
        </div>
        
        <div id="result"></div>
    </div>
    
    <script>
        const API_KEY = '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';
        
        // Base de connaissances embarqu√©e (√©chantillon)
        const KNOWLEDGE_BASE = [
            {
                title: "Guide Complet GLP1 France",
                content: "Ozempic & Wegovy en France : Le Guide Complet. D√©couvrez tout sur ces nouveaux m√©dicaments r√©volutionnaires pour perdre du poids et traiter le diab√®te : prix en France, o√π les acheter, efficacit√© r√©elle, effets secondaires et conseils d'experts. GLP-1 est une hormone naturelle qui r√©gule la glyc√©mie et l'app√©tit.",
                url: "https://glp1-france.fr/",
                keywords: ["glp1", "ozempic", "wegovy", "diab√®te", "perte de poids", "france", "prix", "m√©dicament"]
            },
            {
                title: "Qu'est-ce que GLP1",
                content: "GLP-1 (Glucagon-Like Peptide-1) est une hormone incr√©tine produite naturellement par l'intestin gr√™le. Elle joue un r√¥le crucial dans la r√©gulation de la glyc√©mie en stimulant la s√©cr√©tion d'insuline quand les niveaux de glucose sont √©lev√©s. Les agonistes du r√©cepteur GLP-1 comme Ozempic et Wegovy imitent cette hormone naturelle pour traiter le diab√®te de type 2 et l'ob√©sit√©.",
                url: "https://glp1-france.fr/qu-est-ce-que-glp1/",
                keywords: ["glp1", "hormone", "insuline", "glucose", "glyc√©mie", "incr√©tine", "m√©canisme"]
            },
            {
                title: "Ozempic pour la perte de poids",
                content: "Ozempic (s√©maglutide) est un m√©dicament initialement d√©velopp√© pour le diab√®te de type 2, mais qui s'est r√©v√©l√© tr√®s efficace pour la perte de poids. Il agit en ralentissant la vidange gastrique, en r√©duisant l'app√©tit et en augmentant la sensation de sati√©t√©. Les √©tudes montrent une perte de poids moyenne de 10-15% du poids corporel initial.",
                url: "https://glp1-france.fr/ozempic-perte-de-poids/",
                keywords: ["ozempic", "perte de poids", "s√©maglutide", "app√©tit", "sati√©t√©", "efficacit√©"]
            },
            {
                title: "Prix et remboursement en France",
                content: "En France, Ozempic co√ªte environ 80-100‚Ç¨ par mois sans remboursement pour la perte de poids. Wegovy, sp√©cifiquement autoris√© pour l'ob√©sit√©, co√ªte environ 300‚Ç¨ par mois et n'est pas encore rembours√© par la S√©curit√© sociale. Pour le diab√®te, Ozempic peut √™tre rembours√© √† 65% par l'Assurance maladie sur prescription m√©dicale.",
                url: "https://glp1-france.fr/prix-france/",
                keywords: ["prix", "remboursement", "s√©curit√© sociale", "co√ªt", "france", "prescription"]
            },
            {
                title: "Effets secondaires et pr√©cautions",
                content: "Les effets secondaires les plus courants des agonistes GLP-1 incluent : naus√©es (tr√®s fr√©quent surtout en d√©but de traitement), vomissements, diarrh√©e, constipation, douleurs abdominales. Ces effets diminuent g√©n√©ralement avec le temps. Il est important de commencer avec une faible dose et d'augmenter progressivement. Contre-indiqu√© chez les personnes avec ant√©c√©dents de cancer m√©dullaire de la thyro√Øde.",
                url: "https://glp1-france.fr/effets-secondaires/",
                keywords: ["effets secondaires", "naus√©es", "pr√©cautions", "contre-indications", "s√©curit√©"]
            }
        ];
        
        // Fonction de recherche simple bas√©e sur les mots-cl√©s
        function searchKnowledge(query) {
            const queryLower = query.toLowerCase();
            const queryWords = queryLower.split(' ').filter(word => word.length > 2);
            
            const results = KNOWLEDGE_BASE.map(item => {
                let score = 0;
                
                // Recherche dans les mots-cl√©s
                item.keywords.forEach(keyword => {
                    if (queryLower.includes(keyword)) {
                        score += 3;
                    }
                });
                
                // Recherche dans le contenu
                queryWords.forEach(word => {
                    if (item.content.toLowerCase().includes(word)) {
                        score += 1;
                    }
                    if (item.title.toLowerCase().includes(word)) {
                        score += 2;
                    }
                });
                
                return {
                    ...item,
                    similarity: score / 10, // Normaliser le score
                    chunk: item.content
                };
            });
            
            return results
                .filter(r => r.similarity > 0.1)
                .sort((a, b) => b.similarity - a.similarity)
                .slice(0, 3);
        }
        
        // G√©n√©rer une r√©ponse avec GPT
        async function generateAnswer(query, context) {
            try {
                const prompt = `En tant qu'expert m√©dical sp√©cialis√© dans les traitements GLP1, r√©pondez √† la question suivante en vous basant UNIQUEMENT sur le contexte fourni.

Question: ${query}

Contexte:
${context}

R√©ponse (soyez pr√©cis, informatif et professionnel):`;

                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [
                            {
                                role: 'user',
                                content: prompt
                            }
                        ],
                        max_tokens: 500,
                        temperature: 0.3
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`Erreur API OpenAI: ${response.status}`);
                }
                
                const data = await response.json();
                return data.choices[0].message.content;
            } catch (error) {
                console.error('Erreur g√©n√©ration:', error);
                
                // R√©ponse de fallback si l'API ne fonctionne pas
                return `Bas√© sur les informations disponibles : ${context.substring(0, 300)}...`;
            }
        }
        
        function setQuery(query) {
            document.getElementById('query').value = query;
        }
        
        async function testRAG() {
            const query = document.getElementById('query').value.trim();
            const resultDiv = document.getElementById('result');
            const testBtn = document.getElementById('testBtn');
            
            if (!query) {
                resultDiv.innerHTML = '<div class="result error">Veuillez saisir une question</div>';
                return;
            }
            
            testBtn.disabled = true;
            testBtn.textContent = 'Test en cours...';
            resultDiv.innerHTML = '<div class="result loading">üîç Recherche dans la base de connaissances...</div>';
            
            try {
                // 1. Recherche dans la base de connaissances
                const searchResults = searchKnowledge(query);
                
                if (searchResults.length === 0) {
                    resultDiv.innerHTML = '<div class="result error">‚ùå Aucun contenu pertinent trouv√© pour cette question</div>';
                    return;
                }
                
                resultDiv.innerHTML = '<div class="result loading">ü§ñ G√©n√©ration de la r√©ponse...</div>';
                
                // 2. Cr√©er le contexte
                const context = searchResults.map(r => r.content).join('\n\n');
                
                // 3. G√©n√©rer la r√©ponse
                const answer = await generateAnswer(query, context);
                
                // 4. Afficher les r√©sultats
                displayResults({
                    success: true,
                    answer: answer,
                    results: searchResults
                }, query);
                
            } catch (error) {
                console.error('Erreur:', error);
                resultDiv.innerHTML = `<div class="result error">‚ùå Erreur: ${error.message}</div>`;
            } finally {
                testBtn.disabled = false;
                testBtn.textContent = 'Tester';
            }
        }
        
        function displayResults(data, query) {
            const resultDiv = document.getElementById('result');
            let html = '<div class="result success">';
            
            html += '<h3>‚úÖ Test r√©ussi!</h3>';
            html += `<p><strong>Question:</strong> ${query}</p>`;
            
            if (data.answer) {
                html += `<div class="answer">
                    <h4>ü§ñ R√©ponse de l'IA:</h4>
                    <p>${data.answer.replace(/\n/g, '<br>')}</p>
                </div>`;
            }
            
            if (data.results && data.results.length > 0) {
                html += `<div class="sources">
                    <h4>üìö Sources trouv√©es (${data.results.length}):</h4>`;
                
                data.results.forEach((result, index) => {
                    const similarity = Math.round(result.similarity * 100);
                    html += `<div class="source-item">
                        <span class="similarity">${similarity}% pertinent</span>
                        <strong>${result.title}</strong><br>
                        <small>${result.content.substring(0, 200)}...</small><br>
                        <a href="${result.url}" target="_blank" style="color: #667eea;">üîó Voir la source</a>
                    </div>`;
                });
                
                html += '</div>';
            }
            
            html += '</div>';
            resultDiv.innerHTML = html;
        }
        
        // Test automatique au chargement
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('status').innerHTML = '‚úÖ Base de connaissances pr√™te (5 articles index√©s)';
        });
    </script>
</body>
</html>
