---
import { getCollection } from 'astro:content';

// === DONNÉES STATISTIQUES ===
function countWords(text) {
  if (!text) return 0;
  return text
    .replace(/`{3}[\s\S]*?`{3}/g, ' ')
    .replace(/`[^`]*`/g, ' ')
    .replace(/<[^>]+>/g, ' ')
    .split(/\s+/)
    .filter(Boolean)
    .length;
}

function countOccurrences(text, keyword) {
  if (!keyword) return 0;
  const escaped = keyword.replace(/[-/\\^$*+?.()|[\]{}]/g, '\\$&');
  const regex = new RegExp(`\\b${escaped}\\b`, 'gi');
  return (text.match(regex) || []).length;
}

function countHeadings(md, level) {
  const hashes = '#'.repeat(level);
  const regex = new RegExp(`^${hashes}\\s+.+`, 'gm');
  return (md.match(regex) || []).length;
}

function hasKeywordInHeading(md, keyword, level) {
  if (!keyword) return false;
  const hashes = '#'.repeat(level);
  const regex = new RegExp(`^${hashes}\\s+.*${keyword.replace(/[-/\\^$*+?.()|[\]{}]/g, '\\$&')}.*`, 'gim');
  return regex.test(md);
}

function hasMedicalDisclaimer(md) {
  const disclaimerKeywords = ['avis médical', 'professionnel de santé', 'médecin', 'consultation', 'prescription'];
  return disclaimerKeywords.some(keyword => md.toLowerCase().includes(keyword));
}

function hasInternalLinks(md) {
  const internalLinks = md.match(/\[([^\]]+)\]\(\/[^)]*\)/g) || [];
  return internalLinks.length;
}

function analyzeInterlinks(md) {
  // Liens internes vers d'autres articles
  const internalLinks = md.match(/\[([^\]]+)\]\(\/[^)]*\)/g) || [];
  
  // Liens vers articles similaires ou sections dédiées
  const similarLinksSection = md.includes('## Articles similaires') || md.includes('## Ressources complémentaires');
  
  // Liens dans le contenu principal (pas en fin d'article)
  const contentSections = md.split('## Articles similaires')[0] || md;
  const contentLinks = contentSections.match(/\[([^\]]+)\]\(\/[^)]*\)/g) || [];
  
  return {
    total: internalLinks.length,
    inContent: contentLinks.length,
    hasSimilarSection: similarLinksSection,
    isOptimal: internalLinks.length >= 5 && internalLinks.length <= 15 && contentLinks.length >= 2
  };
}

function calculateSEOScore(md, wordCount, mainKeyword, mainKeywordDensity, interlinks) {
  let score = 0;
  const details = [];
  
  // Structure (35 points max)
  if (countHeadings(md, 1) === 1) {
    score += 10;
    details.push("✓ Un seul H1");
  } else {
    details.push("✗ Problème H1");
  }
  
  if (countHeadings(md, 2) >= 3) {
    score += 10;
    details.push("✓ Structure H2 suffisante");
  } else {
    details.push("✗ Manque de H2");
  }
  
  if (countHeadings(md, 2) <= 8) {
    score += 5;
    details.push("✓ Pas trop de H2");
  } else {
    details.push("⚠ Trop de H2");
  }
  
  // Contenu (35 points max)
  if (wordCount >= 1000) {
    score += 15;
    details.push("✓ Contenu substantiel (1000+ mots)");
  } else if (wordCount >= 500) {
    score += 10;
    details.push("⚠ Contenu moyen (500+ mots)");
  } else {
    details.push("✗ Contenu insuffisant");
  }
  
  if (parseFloat(mainKeywordDensity) >= 1 && parseFloat(mainKeywordDensity) <= 2.5) {
    score += 15;
    details.push("✓ Densité mots-clés optimale");
  } else if (parseFloat(mainKeywordDensity) > 0) {
    score += 8;
    details.push("⚠ Densité mots-clés à ajuster");
  } else {
    details.push("✗ Pas de mot-clé principal");
  }
  
  if (hasMedicalDisclaimer(md)) {
    score += 5;
    details.push("✓ Disclaimer médical");
  } else {
    details.push("✗ Manque disclaimer");
  }
  
  // Interlinks (20 points max)
  if (interlinks.isOptimal) {
    score += 15;
    details.push("✓ Interlinks optimaux");
  } else if (interlinks.total >= 3) {
    score += 10;
    details.push("⚠ Interlinks corrects");
  } else {
    details.push("✗ Manque d'interlinks");
  }
  
  if (interlinks.hasSimilarSection) {
    score += 5;
    details.push("✓ Section articles similaires");
  } else {
    details.push("✗ Pas de section similaires");
  }
  
  // Bonus qualité (10 points max)
  if (md.includes('**Important :**')) {
    score += 3;
    details.push("✓ Avertissement important");
  }
  
  if (md.includes('## À retenir')) {
    score += 3;
    details.push("✓ Section récapitulative");
  }
  
  if (md.includes('FAQ') || md.includes('Questions fréquentes')) {
    score += 4;
    details.push("✓ Section FAQ");
  }
  
  return { score: Math.min(score, 100), details };
}

// === COLLECTE DES DONNÉES ===
let detailedStats = [];
let totalArticles = 0;
let emptyArticles = 0;

// Toujours collecter les données - l'auth se fait côté client
const collectionNames = [
  'alternatives-glp1',
  'glp1-perte-de-poids', 
  'effets-secondaires-glp1',
  'glp1-cout',
  'glp1-diabete',
  'medecins-glp1-france',
  'medicaments-glp1',
  'recherche-glp1',
  'regime-glp1'
];

const allEntries = [];
for (const name of collectionNames) {
  try {
    const entries = await getCollection(name);
    allEntries.push(...entries.map(e => ({ ...e, _collection: name })));
  } catch (e) {
    // ignore missing collection
    }
  }

  // Analyse de chaque article
  detailedStats = allEntries.map(article => {
    const md = article.body || '';
    const text = md.replace(/![^\n]*\n?/g, ' ')
                   .replace(/\[[^\]]*\]\([^)]*\)/g, ' ')
                   .replace(/<[^>]+>/g, ' ');

    const wordCount = countWords(text);
    const mainKeyword = article.data.keyword || article.data.mainKeyword || '';
    
    const mainKeywordCount = countOccurrences(text, mainKeyword);
    const mainKeywordDensity = mainKeyword ? 
      ((mainKeywordCount / Math.max(wordCount, 1)) * 100).toFixed(2) : '0.00';

    // Analyse des interlinks
    const interlinks = analyzeInterlinks(md);
    
    // Score SEO détaillé
    const seoAnalysis = calculateSEOScore(md, wordCount, mainKeyword, mainKeywordDensity, interlinks);

    return {
      collection: article._collection,
      slug: article.slug,
      title: article.data.title || 'Sans titre',
      wordCount,
      mainKeyword,
      mainKeywordDensity: parseFloat(mainKeywordDensity),
      h1Count: countHeadings(md, 1),
      h2Count: countHeadings(md, 2),
      hasMedicalDisclaimer: hasMedicalDisclaimer(md),
      interlinks,
      internalLinksCount: interlinks.total, // Pour compatibilité affichage
      seoScore: seoAnalysis.score,
      seoDetails: seoAnalysis.details,
      isEmpty: wordCount < 200
    };
  });

  // Statistiques globales
  totalArticles = detailedStats.length;
  emptyArticles = detailedStats.filter(s => s.isEmpty).length;
---

<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard Protégé - GLP-1 France</title>
  <style>
    body { 
      font-family: 'Segoe UI', Arial, sans-serif; 
      margin: 0; 
      padding: 20px; 
      background: #f8f9fa; 
    }
    .login-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .login-form {
      background: white;
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      text-align: center;
      min-width: 300px;
    }
    .login-form h2 {
      margin-bottom: 30px;
      color: #333;
    }
    .login-form input {
      width: 100%;
      padding: 12px;
      margin-bottom: 20px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 16px;
      box-sizing: border-box;
    }
    .login-form button {
      width: 100%;
      padding: 12px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
    }
    .login-form button:hover {
      background: #5a6fd8;
    }
    .error-message {
      color: #dc3545;
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      padding: 10px;
      border-radius: 6px;
      margin-bottom: 20px;
      text-align: center;
      display: none;
    }
    .hidden {
      display: none !important;
    }
    table {
      font-size: 14px;
    }
    table th {
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-size: 12px;
    }
    table td {
      vertical-align: top;
    }
    table tr:hover {
      background-color: #f8f9fa;
    }
    
    /* SYSTÈME DE TABULATIONS */
    .tabs-container {
      margin-top: 30px;
    }
    .tabs-header {
      display: flex;
      background: white;
      border-radius: 12px 12px 0 0;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    .tab-btn {
      flex: 1;
      padding: 20px;
      border: none;
      background: #f8f9fa;
      color: #666;
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      border-bottom: 3px solid transparent;
    }
    .tab-btn:hover {
      background: #e9ecef;
      color: #333;
    }
    .tab-btn.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-bottom: 3px solid #fff;
    }
    .tab-content {
      display: none;
      background: #f8f9fa;
      border-radius: 0 0 12px 12px;
      min-height: 500px;
    }
    .tab-content.active {
      display: block;
    }
    .orange {
      color: #ffc107;
    }
    .container { 
      max-width: 1400px; 
      margin: 0 auto; 
    }
    .header { 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
      color: white; 
      padding: 30px; 
      border-radius: 12px; 
      margin-bottom: 30px; 
    }
    .header h1 { 
      margin: 0; 
      font-size: 2.5em; 
      font-weight: 300; 
    }
    .header p { 
      margin: 10px 0 0 0; 
      opacity: 0.9; 
      font-size: 1.1em; 
    }
    .stats-grid { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
      gap: 20px; 
      margin-bottom: 30px; 
    }
    .stat-card { 
      background: white; 
      padding: 25px; 
      border-radius: 12px; 
      box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
      text-align: center; 
    }
    .stat-number { 
      font-size: 2.5em; 
      font-weight: bold; 
      margin-bottom: 10px; 
    }
    .stat-label { 
      color: #666; 
      font-size: 1.1em; 
    }
    .red { color: #dc3545; }
    .green { color: #28a745; }
    .roadmap-section {
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    .roadmap-phase {
      border-radius: 8px;
      margin-bottom: 30px;
      padding: 25px;
      transition: transform 0.2s ease;
    }
    .roadmap-phase:hover {
      transform: translateX(5px);
    }
    .roadmap-phase h4 {
      font-size: 1.3em;
      margin-bottom: 15px;
      margin-top: 0;
    }
    .logout-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 10px 20px;
      background: #dc3545;
      color: white;
      border: none;
      border-radius: 6px;
  </style>
</head>
<body>
  <!-- Formulaire de connexion -->
  <div id="login-container" class="login-container">
    <form id="login-form" class="login-form">
      <h2>🔒 Accès Dashboard</h2>
      <div id="error-message" class="error-message">Mot de passe incorrect. Veuillez réessayer.</div>
      <input type="password" id="password-input" placeholder="Mot de passe" required />
      <button type="submit">Se connecter</button>
    </form>
  </div>
  
  <!-- Dashboard principal -->
  <div id="dashboard-container" class="container hidden">
    <button id="logout-btn" class="logout-btn">🚪 Déconnexion</button>
      
      <div class="header">
        <h1>🏥 Dashboard Protégé - GLP-1 France</h1>
        <p>Monitoring complet • SEO • Monétisation</p>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-number">{totalArticles}</div>
          <div class="stat-label">Articles total</div>
        </div>
        <div class="stat-card">
          <div class="stat-number red">{emptyArticles}</div>
          <div class="stat-label">Articles vides</div>
        </div>
        <div class="stat-card">
          <div class="stat-number green">{totalArticles - emptyArticles}</div>
          <div class="stat-label">Articles publiés</div>
        </div>
      </div>

      <!-- SYSTÈME DE TABULATIONS -->
      <div class="tabs-container">
        <div class="tabs-header">
          <button class="tab-btn active" data-tab="collections">📊 Collections</button>
          <button class="tab-btn" data-tab="articles">📝 Articles</button>
          <button class="tab-btn" data-tab="keywords">🔍 Mots-clés</button>
          <button class="tab-btn" data-tab="roadmap">🚀 Roadmap</button>
        </div>

        <!-- TAB 1: COLLECTIONS -->
        <div class="tab-content active" id="tab-collections">
          <div class="collections-section">
            <h3>📊 Analyse par Collection</h3>
            
            <div style="overflow-x: auto; margin-bottom: 30px;">
              <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                <thead>
                  <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <th style="padding: 15px; text-align: left;">Collection</th>
                    <th style="padding: 15px; text-align: center;">Articles</th>
                    <th style="padding: 15px; text-align: center;">Vides</th>
                    <th style="padding: 15px; text-align: center;">Publiés</th>
                    <th style="padding: 15px; text-align: center;">% Complétude</th>
                    <th style="padding: 15px; text-align: center;">Score Moyen</th>
                  </tr>
                </thead>
                <tbody>
                  {detailedStats.reduce((acc, article) => {
                    const collection = article.collection;
                    if (!acc.find(c => c.collection === collection)) {
                      const collectionArticles = detailedStats.filter(a => a.collection === collection);
                      const emptyCount = collectionArticles.filter(a => a.isEmpty).length;
                      const publishedCount = collectionArticles.length - emptyCount;
                      const completionRate = ((publishedCount / collectionArticles.length) * 100).toFixed(1);
                      const avgScore = (collectionArticles.reduce((sum, a) => sum + a.seoScore, 0) / collectionArticles.length).toFixed(1);
                      
                      acc.push({
                        collection,
                        total: collectionArticles.length,
                        empty: emptyCount,
                        published: publishedCount,
                        completion: completionRate,
                        avgScore: avgScore
                      });
                    }
                    return acc;
                  }, []).map(collection => (
                    <tr style="border-bottom: 1px solid #eee;">
                      <td style="padding: 12px; font-weight: 500;">{collection.collection}</td>
                      <td style="padding: 12px; text-align: center;">{collection.total}</td>
                      <td style="padding: 12px; text-align: center; color: #dc3545;">{collection.empty}</td>
                      <td style="padding: 12px; text-align: center; color: #28a745;">{collection.published}</td>
                      <td style="padding: 12px; text-align: center;">
                        <span style={`color: ${parseFloat(collection.completion) >= 70 ? '#28a745' : parseFloat(collection.completion) >= 50 ? '#ffc107' : '#dc3545'}`}>
                          {collection.completion}%
                        </span>
                      </td>
                      <td style="padding: 12px; text-align: center;">
                        <span style={`font-weight: bold; color: ${parseFloat(collection.avgScore) >= 70 ? '#28a745' : parseFloat(collection.avgScore) >= 50 ? '#ffc107' : '#dc3545'}`}>
                          {collection.avgScore}/100
                        </span>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- TAB 2: ARTICLES -->
        <div class="tab-content" id="tab-articles">
          <div class="articles-section">
            <h3>📝 Tous les Articles ({totalArticles})</h3>
            <div style="overflow-x: auto;">
              <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                <thead>
                  <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <th style="padding: 12px; text-align: left;">Article</th>
                    <th style="padding: 12px; text-align: center;">Collection</th>
                    <th style="padding: 12px; text-align: center;">Mots</th>
                    <th style="padding: 12px; text-align: center;">H1</th>
                    <th style="padding: 12px; text-align: center;">H2</th>
                    <th style="padding: 12px; text-align: center;">Liens Int.</th>
                    <th style="padding: 12px; text-align: center;">Optim. Liens</th>
                    <th style="padding: 12px; text-align: center;">Score SEO</th>
                    <th style="padding: 12px; text-align: center;">Action</th>
                  </tr>
                </thead>
                <tbody>
                  {detailedStats
                    .sort((a, b) => {
                      // Tri par priorité : articles vides d'abord, puis par score SEO croissant
                      if (a.isEmpty && !b.isEmpty) return -1;
                      if (!a.isEmpty && b.isEmpty) return 1;
                      return a.seoScore - b.seoScore;
                    })
                    .map(article => (
                    <tr style="border-bottom: 1px solid #eee;">
                      <td style="padding: 10px; font-size: 14px;">
                        <strong>{article.title.length > 40 ? article.title.substring(0, 40) + '...' : article.title}</strong>
                        <br />
                        <small style="color: #666;">/{article.collection}/{article.slug}</small>
                      </td>
                      <td style="padding: 10px; text-align: center; font-size: 12px;">{article.collection.replace('glp1-', '').replace('-', ' ')}</td>
                      <td style="padding: 10px; text-align: center;">
                        <span style={`color: ${article.wordCount >= 1000 ? '#28a745' : article.wordCount >= 500 ? '#ffc107' : '#dc3545'}`}>
                          {article.wordCount}
                        </span>
                      </td>
                      <td style="padding: 10px; text-align: center;">
                        <span style={`color: ${article.h1Count === 1 ? '#28a745' : '#dc3545'}`}>
                          {article.h1Count}
                        </span>
                      </td>
                      <td style="padding: 10px; text-align: center;">
                        <span style={`color: ${article.h2Count >= 3 ? '#28a745' : article.h2Count >= 1 ? '#ffc107' : '#dc3545'}`}>
                          {article.h2Count}
                        </span>
                      </td>
                      <td style="padding: 10px; text-align: center;">
                        <span style={`color: ${article.internalLinksCount >= 5 ? '#28a745' : article.internalLinksCount >= 2 ? '#ffc107' : '#dc3545'}`}>
                          {article.internalLinksCount}
                        </span>
                      </td>
                      <td style="padding: 10px; text-align: center;">
                        <span style={`color: ${article.interlinks.isOptimal ? '#28a745' : '#dc3545'}; font-size: 16px;`}>
                          {article.interlinks.isOptimal ? '✅' : '❌'}
                        </span>
                        <br />
                        <small style="color: #666; font-size: 10px;" title="Liens dans contenu / Section similaires">
                          {article.interlinks.inContent}c • {article.interlinks.hasSimilarSection ? '✓' : '✗'}s
                        </small>
                      </td>
                      <td style="padding: 10px; text-align: center;">
                        <span style={`font-weight: bold; color: ${article.seoScore >= 80 ? '#28a745' : article.seoScore >= 60 ? '#ffc107' : '#dc3545'}`}>
                          {article.seoScore}/100
                        </span>
                      </td>
                      <td style="padding: 10px; text-align: center; font-size: 12px;">
                        {article.isEmpty ? '🆕 Créer' : 
                         article.wordCount < 500 ? '📝 Étoffer' : 
                         article.h2Count < 3 ? '🏗️ Structurer' : 
                         !article.interlinks.isOptimal ? '🔗 Optimiser liens' : 
                         '✅ Améliorer'}
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- TAB 3: MOTS-CLÉS -->
        <div class="tab-content" id="tab-keywords">
          <div class="keywords-section">
            <h3>🔍 Analyse des Mots-clés</h3>
            
            <div class="stats-grid" style="margin-bottom: 30px;">
              <div class="stat-card">
                <div class="stat-number">{detailedStats.filter(a => a.mainKeyword && a.mainKeywordDensity >= 1 && a.mainKeywordDensity <= 3).length}</div>
                <div class="stat-label">Densité optimale</div>
              </div>
              <div class="stat-card">
                <div class="stat-number red">{detailedStats.filter(a => !a.mainKeyword || a.mainKeyword === '').length}</div>
                <div class="stat-label">Sans mot-clé</div>
              </div>
              <div class="stat-card">
                <div class="stat-number orange">{detailedStats.filter(a => a.mainKeywordDensity < 1 || a.mainKeywordDensity > 3).length}</div>
                <div class="stat-label">Densité à ajuster</div>
              </div>
            </div>

            <div style="overflow-x: auto;">
              <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                <thead>
                  <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <th style="padding: 12px; text-align: left;">Article</th>
                    <th style="padding: 12px; text-align: center;">Mot-clé principal</th>
                    <th style="padding: 12px; text-align: center;">Densité</th>
                    <th style="padding: 12px; text-align: center;">Occurrences</th>
                    <th style="padding: 12px; text-align: center;">Status</th>
                    <th style="padding: 12px; text-align: center;">Recommandation</th>
                  </tr>
                </thead>
                <tbody>
                  {detailedStats
                    .filter(article => article.mainKeyword || article.wordCount > 200)
                    .sort((a, b) => {
                      if (!a.mainKeyword && b.mainKeyword) return 1;
                      if (a.mainKeyword && !b.mainKeyword) return -1;
                      return Math.abs(2 - a.mainKeywordDensity) - Math.abs(2 - b.mainKeywordDensity);
                    })
                    .slice(0, 25)
                    .map(article => (
                      <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 10px; font-size: 14px;">
                          <strong>{article.title.length > 35 ? article.title.substring(0, 35) + '...' : article.title}</strong>
                          <br />
                          <small style="color: #666;">{article.collection}</small>
                        </td>
                        <td style="padding: 10px; text-align: center; font-size: 13px;">
                          {article.mainKeyword ? (article.mainKeyword.length > 20 ? article.mainKeyword.substring(0, 20) + '...' : article.mainKeyword) : '❌ Non défini'}
                        </td>
                        <td style="padding: 10px; text-align: center;">
                          <span style={`font-weight: bold; color: ${article.mainKeyword && article.mainKeywordDensity >= 1 && article.mainKeywordDensity <= 3 ? '#28a745' : article.mainKeyword ? '#dc3545' : '#6c757d'}`}>
                            {article.mainKeyword ? article.mainKeywordDensity + '%' : 'N/A'}
                          </span>
                        </td>
                        <td style="padding: 10px; text-align: center;">
                          {article.mainKeyword ? Math.round((article.mainKeywordDensity * article.wordCount) / 100) : 'N/A'}
                        </td>
                        <td style="padding: 10px; text-align: center;">
                          {!article.mainKeyword && '🔍 À définir'}
                          {article.mainKeyword && article.mainKeywordDensity >= 1 && article.mainKeywordDensity <= 3 && '✅ Optimal'}
                          {article.mainKeyword && article.mainKeywordDensity < 1 && '📈 Trop faible'}
                          {article.mainKeyword && article.mainKeywordDensity > 3 && '📉 Trop élevée'}
                        </td>
                        <td style="padding: 10px; text-align: center; font-size: 12px;">
                          {!article.mainKeyword && 'Choisir mot-clé'}
                          {article.mainKeyword && article.mainKeywordDensity < 1 && 'Ajouter occurrences'}
                          {article.mainKeyword && article.mainKeywordDensity > 3 && 'Réduire densité'}
                          {article.mainKeyword && article.mainKeywordDensity >= 1 && article.mainKeywordDensity <= 3 && 'Maintenir'}
                        </td>
                      </tr>
                    ))}
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- TAB 4: ROADMAP -->
        <div class="tab-content" id="tab-roadmap">
          <div class="roadmap-section">
            <h3>🚀 Roadmap - Affiliation et Monétisation</h3>
            
            <div class="roadmap-phase" style="border-left: 5px solid #667eea; background: #f8f9ff;">
              <h4 style="color: #667eea;">📋 Phase 1 : Affiliation</h4>
              <p><strong>Objectif :</strong> Intégrer des partenariats d'affiliation pertinents</p>
              <ul style="line-height: 1.8;">
                <li><strong>Prospection d'affiliations :</strong>
                  <ul>
                    <li>Plateformes d'affiliation (Amazon, CJ Affiliate, ShareASale)</li>
                    <li>Sites de cosmétiques et bien-être (Sephora, Douglas, etc.)</li>
                    <li>Compléments alimentaires (Nutrimea, Biovancia)</li>
                    <li>Pharmacies en ligne (Doctipharma, PharmashopDiscount)</li>
                  </ul>
                </li>
                <li><strong>Création de bannières :</strong>
                  <ul>
                    <li>Bannières contextuelles dans les articles</li>
                    <li>Sidebar avec produits recommandés</li>
                    <li>Call-to-action en fin d'articles</li>
                    <li>Intégration native dans le contenu</li>
                  </ul>
                </li>
              </ul>
            </div>

            <div class="roadmap-phase" style="border-left: 5px solid #28a745; background: #f8fff8;">
              <h4 style="color: #28a745;">📧 Phase 2 : Collecte de Données Utilisateurs</h4>
              <p><strong>Objectif :</strong> Constituer une base de données qualifiée avec l'email comme identifiant unique</p>
              <ul style="line-height: 1.8;">
                <li><strong>Points de collecte :</strong>
                  <ul>
                    <li>Newsletter footer (existant - à optimiser)</li>
                    <li>Pop-up d'inscription stratégique</li>
                    <li>Formulaire de téléchargement du guide PDF</li>
                    <li>Commentaires et questions d'articles</li>
                    <li>Quiz interactifs sur les traitements</li>
                  </ul>
                </li>
                <li><strong>Base de données :</strong>
                  <ul>
                    <li>Email (identifiant unique)</li>
                    <li>Prénom / Nom</li>
                    <li>Âge / Tranche d'âge</li>
                    <li>Localisation (région/département)</li>
                    <li>Traitement actuel / Intérêt</li>
                    <li>Source d'acquisition</li>
                    <li>Date d'inscription</li>
                    <li>Historique d'engagement</li>
                  </ul>
                </li>
              </ul>
            </div>

            <div class="roadmap-phase" style="border-left: 5px solid #ffc107; background: #fffef8;">
              <h4 style="color: #f39c12;">📖 Phase 3 : Guide PDF Complet</h4>
              <p><strong>Objectif :</strong> Créer un guide de référence A-Z pour traiter les effets secondaires</p>
              <ul style="line-height: 1.8;">
                <li><strong>Contenu du guide :</strong>
                  <ul>
                    <li>Classification des effets secondaires par gravité</li>
                    <li>Solutions naturelles et médicamenteuses</li>
                    <li>Protocoles de gestion par symptôme</li>
                    <li>Quand consulter un professionnel</li>
                    <li>Témoignages et cas pratiques</li>
                    <li>Check-lists et aide-mémoires</li>
                  </ul>
                </li>
                <li><strong>Monétisation :</strong>
                  <ul>
                    <li>Lead magnet pour collecte d'emails</li>
                    <li>Version premium payante</li>
                    <li>Liens d'affiliation intégrés</li>
                    <li>Mise à jour régulière</li>
                  </ul>
                </li>
              </ul>
            </div>

            <div class="roadmap-phase" style="border-left: 5px solid #dc3545; background: #fff8f8;">
              <h4 style="color: #dc3545;">🏥 Phase 4 : Annuaire de Professionnels</h4>
              <p><strong>Objectif :</strong> Créer un annuaire complet des professionnels de santé spécialisés</p>
              <ul style="line-height: 1.8;">
                <li><strong>Scraping et collecte :</strong>
                  <ul>
                    <li>Endocrinologues par ville/département/région</li>
                    <li>Cliniques spécialisées en obésité</li>
                    <li>Centres de diabétologie</li>
                    <li>Nutritionnistes certifiés</li>
                    <li>Sources : Pages Jaunes, Doctolib, ordre des médecins</li>
                  </ul>
                </li>
                <li><strong>Données à collecter :</strong>
                  <ul>
                    <li>Nom, prénom, titre</li>
                    <li>Spécialités et certifications</li>
                    <li>Adresse complète</li>
                    <li>Téléphone, email, site web</li>
                    <li>Horaires et disponibilités</li>
                    <li>Acceptation secteur 1/2</li>
                    <li>Langues parlées</li>
                  </ul>
                </li>
                <li><strong>Monétisation :</strong>
                  <ul>
                    <li>Référencement payant des professionnels</li>
                    <li>Publicités géolocalisées</li>
                    <li>Partenariats avec cliniques privées</li>
                    <li>Commission sur prises de rendez-vous</li>
                  </ul>
                </li>
              </ul>
            </div>

            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 8px; text-align: center;">
              <h4 style="margin-top: 0;">🎯 Objectifs de Revenus</h4>
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
                <div>
                  <div style="font-size: 2em; font-weight: bold;">1000€</div>
                  <div>Mois 1-3 (Affiliation)</div>
                </div>
                <div>
                  <div style="font-size: 2em; font-weight: bold;">3000€</div>
                  <div>Mois 4-6 (Guide + Base)</div>
                </div>
                <div>
                  <div style="font-size: 2em; font-weight: bold;">5000€</div>
                  <div>Mois 7-12 (Annuaire)</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
        <h3>🚀 Roadmap - Affiliation et Monétisation</h3>
        
        <div class="roadmap-phase" style="border-left: 5px solid #667eea; background: #f8f9ff;">
          <h4 style="color: #667eea;">📋 Phase 1 : Affiliation</h4>
          <p><strong>Objectif :</strong> Intégrer des partenariats d'affiliation pertinents</p>
          <ul style="line-height: 1.8;">
            <li><strong>Prospection d'affiliations :</strong>
              <ul>
                <li>Plateformes d'affiliation (Amazon, CJ Affiliate, ShareASale)</li>
                <li>Sites de cosmétiques et bien-être (Sephora, Douglas, etc.)</li>
                <li>Compléments alimentaires (Nutrimea, Biovancia)</li>
                <li>Pharmacies en ligne (Doctipharma, PharmashopDiscount)</li>
              </ul>
            </li>
            <li><strong>Création de bannières :</strong>
              <ul>
                <li>Bannières contextuelles dans les articles</li>
                <li>Sidebar avec produits recommandés</li>
                <li>Call-to-action en fin d'articles</li>
                <li>Intégration native dans le contenu</li>
              </ul>
            </li>
          </ul>
        </div>

        <div class="roadmap-phase" style="border-left: 5px solid #28a745; background: #f8fff8;">
          <h4 style="color: #28a745;">📧 Phase 2 : Collecte de Données Utilisateurs</h4>
          <p><strong>Objectif :</strong> Constituer une base de données qualifiée avec l'email comme identifiant unique</p>
          <ul style="line-height: 1.8;">
            <li><strong>Points de collecte :</strong>
              <ul>
                <li>Newsletter footer (existant - à optimiser)</li>
                <li>Pop-up d'inscription stratégique</li>
                <li>Formulaire de téléchargement du guide PDF</li>
                <li>Commentaires et questions d'articles</li>
                <li>Quiz interactifs sur les traitements</li>
              </ul>
            </li>
            <li><strong>Base de données :</strong>
              <ul>
                <li>Email (identifiant unique)</li>
                <li>Prénom / Nom</li>
                <li>Âge / Tranche d'âge</li>
                <li>Localisation (région/département)</li>
                <li>Traitement actuel / Intérêt</li>
                <li>Source d'acquisition</li>
                <li>Date d'inscription</li>
                <li>Historique d'engagement</li>
              </ul>
            </li>
          </ul>
        </div>

        <div class="roadmap-phase" style="border-left: 5px solid #ffc107; background: #fffef8;">
          <h4 style="color: #f39c12;">📖 Phase 3 : Guide PDF Complet</h4>
          <p><strong>Objectif :</strong> Créer un guide de référence A-Z pour traiter les effets secondaires</p>
          <ul style="line-height: 1.8;">
            <li><strong>Contenu du guide :</strong>
              <ul>
                <li>Classification des effets secondaires par gravité</li>
                <li>Solutions naturelles et médicamenteuses</li>
                <li>Protocoles de gestion par symptôme</li>
                <li>Quand consulter un professionnel</li>
                <li>Témoignages et cas pratiques</li>
                <li>Check-lists et aide-mémoires</li>
              </ul>
            </li>
            <li><strong>Monétisation :</strong>
              <ul>
                <li>Lead magnet pour collecte d'emails</li>
                <li>Version premium payante</li>
                <li>Liens d'affiliation intégrés</li>
                <li>Mise à jour régulière</li>
              </ul>
            </li>
          </ul>
        </div>

        <div class="roadmap-phase" style="border-left: 5px solid #dc3545; background: #fff8f8;">
          <h4 style="color: #dc3545;">🏥 Phase 4 : Annuaire de Professionnels</h4>
          <p><strong>Objectif :</strong> Créer un annuaire complet des professionnels de santé spécialisés</p>
          <ul style="line-height: 1.8;">
            <li><strong>Scraping et collecte :</strong>
              <ul>
                <li>Endocrinologues par ville/département/région</li>
                <li>Cliniques spécialisées en obésité</li>
                <li>Centres de diabétologie</li>
                <li>Nutritionnistes certifiés</li>
                <li>Sources : Pages Jaunes, Doctolib, ordre des médecins</li>
              </ul>
            </li>
            <li><strong>Données à collecter :</strong>
              <ul>
                <li>Nom, prénom, titre</li>
                <li>Spécialités et certifications</li>
                <li>Adresse complète</li>
                <li>Téléphone, email, site web</li>
                <li>Horaires et disponibilités</li>
                <li>Acceptation secteur 1/2</li>
                <li>Langues parlées</li>
              </ul>
            </li>
            <li><strong>Monétisation :</strong>
              <ul>
                <li>Référencement payant des professionnels</li>
                <li>Publicités géolocalisées</li>
                <li>Partenariats avec cliniques privées</li>
                <li>Commission sur prises de rendez-vous</li>
              </ul>
            </li>
          </ul>
        </div>

        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 8px; text-align: center;">
          <h4 style="margin-top: 0;">🎯 Objectifs de Revenus</h4>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
            <div>
              <div style="font-size: 2em; font-weight: bold;">1000€</div>
              <div>Mois 1-3 (Affiliation)</div>
            </div>
            <div>
              <div style="font-size: 2em; font-weight: bold;">3000€</div>
              <div>Mois 4-6 (Guide + Base)</div>
            </div>
            <div>
              <div style="font-size: 2em; font-weight: bold;">5000€</div>
              <div>Mois 7-12 (Annuaire)</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const PASSWORD = "12031990Robin!";
    const AUTH_KEY = "admin-dashboard-auth";
    
    // Éléments DOM
    const loginContainer = document.getElementById('login-container');
    const dashboardContainer = document.getElementById('dashboard-container');
    const loginForm = document.getElementById('login-form');
    const passwordInput = document.getElementById('password-input');
    const errorMessage = document.getElementById('error-message');
    const logoutBtn = document.getElementById('logout-btn');
    
    // Vérifier l'authentification au chargement
    function checkAuth() {
      const authExpiry = localStorage.getItem(AUTH_KEY);
      const now = Date.now();
      
      if (authExpiry && now < parseInt(authExpiry)) {
        showDashboard();
      } else {
        localStorage.removeItem(AUTH_KEY);
        showLogin();
      }
    }
    
    // Afficher le formulaire de connexion
    function showLogin() {
      loginContainer.classList.remove('hidden');
      dashboardContainer.classList.add('hidden');
      errorMessage.style.display = 'none';
      passwordInput.focus();
    }
    
    // Afficher le dashboard
    function showDashboard() {
      loginContainer.classList.add('hidden');
      dashboardContainer.classList.remove('hidden');
    }
    
    // Gérer la connexion
    loginForm.addEventListener('submit', function(e) {
      e.preventDefault();
      const inputPassword = passwordInput.value;
      
      if (inputPassword === PASSWORD) {
        // Authentification réussie - valable 24h
        const expiry = Date.now() + (24 * 60 * 60 * 1000);
        localStorage.setItem(AUTH_KEY, expiry.toString());
        showDashboard();
        passwordInput.value = '';
      } else {
        // Mot de passe incorrect
        errorMessage.style.display = 'block';
        passwordInput.value = '';
        passwordInput.focus();
      }
    });
    
    // Gérer la déconnexion
    logoutBtn.addEventListener('click', function() {
      localStorage.removeItem(AUTH_KEY);
      showLogin();
    });
    
    // GESTION DES TABULATIONS
    function initTabs() {
      const tabBtns = document.querySelectorAll('.tab-btn');
      const tabContents = document.querySelectorAll('.tab-content');
      
      tabBtns.forEach(btn => {
        btn.addEventListener('click', function() {
          const targetTab = this.getAttribute('data-tab');
          
          // Désactiver tous les boutons et contenus
          tabBtns.forEach(b => b.classList.remove('active'));
          tabContents.forEach(c => c.classList.remove('active'));
          
          // Activer le bouton et contenu sélectionnés
          this.classList.add('active');
          document.getElementById('tab-' + targetTab).classList.add('active');
        });
      });
    }
    
    // Initialiser
    checkAuth();
    initTabs();
  </script>
</body>
</html>
