---
import BaseLayout from '../../layouts/BaseLayout.astro'
import { getCollection } from 'astro:content'

// Récupérer tous les articles de toutes les collections
const allArticles = await Promise.all([
  getCollection('glp1-perte-de-poids'),
  getCollection('glp1-diabete'),
  getCollection('glp1-cout'),
  getCollection('effets-secondaires-glp1'),
  getCollection('alternatives-glp1'),
  getCollection('medicaments-glp1'),
  getCollection('regime-glp1'),
  getCollection('avant-apres-glp1'),
  getCollection('recherche-glp1'),
  getCollection('medecins-glp1-france'),
]).then(collections => {
  return collections.flat().map(article => ({
    ...article,
    // Détermine la catégorie depuis le slug
    category: article.id.includes('/') ? article.collection : article.collection,
    url: `/${article.collection}/${article.slug}/`
  }))
}).then(articles => {
  // Trier par date de publication (plus récent en premier)
  return articles.sort((a, b) => {
    const dateA = new Date(a.data.publishedAt || a.data.publishDate || '2024-01-01')
    const dateB = new Date(b.data.publishedAt || b.data.publishDate || '2024-01-01')
    return dateB - dateA
  })
})

// Configuration des couleurs par catégorie
const categoryColors = {
  'glp1-perte-de-poids': { bg: 'bg-green-50', text: 'text-green-700', border: 'border-green-200' },
  'glp1-diabete': { bg: 'bg-blue-50', text: 'text-blue-700', border: 'border-blue-200' },
  'glp1-cout': { bg: 'bg-yellow-50', text: 'text-yellow-700', border: 'border-yellow-200' },
  'effets-secondaires-glp1': { bg: 'bg-red-50', text: 'text-red-700', border: 'border-red-200' },
  'alternatives-glp1': { bg: 'bg-purple-50', text: 'text-purple-700', border: 'border-purple-200' },
  'medicaments-glp1': { bg: 'bg-indigo-50', text: 'text-indigo-700', border: 'border-indigo-200' },
  'regime-glp1': { bg: 'bg-orange-50', text: 'text-orange-700', border: 'border-orange-200' },
  'avant-apres-glp1': { bg: 'bg-pink-50', text: 'text-pink-700', border: 'border-pink-200' },
  'recherche-glp1': { bg: 'bg-teal-50', text: 'text-teal-700', border: 'border-teal-200' },
  'medecins-glp1-france': { bg: 'bg-gray-50', text: 'text-gray-700', border: 'border-gray-200' }
}

// Configuration des noms de catégories
const categoryNames = {
  'glp1-perte-de-poids': 'Perte de Poids',
  'glp1-diabete': 'Diabète',
  'glp1-cout': 'Prix et Coûts',
  'effets-secondaires-glp1': 'Effets Secondaires',
  'alternatives-glp1': 'Alternatives',
  'medicaments-glp1': 'Médicaments',
  'regime-glp1': 'Régime et Nutrition',
  'avant-apres-glp1': 'Témoignages',
  'recherche-glp1': 'Recherche Scientifique',
  'medecins-glp1-france': 'Médecins en France'
}
---

<BaseLayout 
  title="Tous les Articles sur les GLP-1 - Guide Complet" 
  description="Découvrez tous nos articles sur les médicaments GLP-1 : perte de poids, diabète, effets secondaires, prix, médecins en France et bien plus."
>
  <main class="bg-white">
    <!-- Header Section -->
    <section class="py-12 bg-gradient-to-br from-green-50 to-blue-50">
      <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto text-center">
          <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-6">
            Tous les Articles sur les <span class="text-green-600">GLP-1</span>
          </h1>
          <p class="text-xl text-gray-600 mb-8">
            Découvrez notre collection complète d'articles sur les médicaments GLP-1 : 
            guides pratiques, témoignages, recherches scientifiques et conseils d'experts.
          </p>
          <div class="bg-white rounded-lg p-6 shadow-lg inline-block">
            <p class="text-lg font-semibold text-gray-800">
              <span class="text-green-600 text-2xl font-bold">{allArticles.length}</span> articles disponibles
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- Articles Grid -->
    <section class="py-16">
      <div class="container mx-auto px-4">
        <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
          {allArticles.map((article) => {
            const colors = categoryColors[article.collection] || categoryColors['glp1-perte-de-poids']
            const categoryName = categoryNames[article.collection] || article.collection
            
            return (
              <article class={`bg-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 overflow-hidden border ${colors.border}`}>
                <div class={`p-4 ${colors.bg}`}>
                  <span class={`inline-block px-3 py-1 rounded-full text-sm font-medium ${colors.text} bg-white`}>
                    {categoryName}
                  </span>
                </div>
                
                <div class="p-6">
                  <h2 class="text-xl font-bold text-gray-900 mb-3 line-clamp-2">
                    <a href={article.url} class="hover:text-green-600 transition-colors">
                      {article.data.title}
                    </a>
                  </h2>
                  
                  {article.data.description && (
                    <p class="text-gray-600 mb-4 line-clamp-3">
                      {article.data.description}
                    </p>
                  )}
                  
                  <div class="flex items-center justify-between text-sm text-gray-500 mb-4">
                    {article.data.publishedAt && (
                      <time dateTime={article.data.publishedAt}>
                        {new Date(article.data.publishedAt).toLocaleDateString('fr-FR', {
                          year: 'numeric',
                          month: 'long',
                          day: 'numeric'
                        })}
                      </time>
                    )}
                    
                    {article.data.readingTime && (
                      <span>{article.data.readingTime} min de lecture</span>
                    )}
                  </div>
                  
                  <a 
                    href={article.url}
                    class="inline-flex items-center text-green-600 font-medium hover:text-green-700 transition-colors"
                  >
                    Lire l'article
                    <svg class="ml-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                  </a>
                </div>
              </article>
            )
          })}
        </div>
      </div>
    </section>

    <!-- CTA Section -->
    <section class="py-16 bg-gradient-to-r from-green-600 to-blue-600">
      <div class="container mx-auto px-4 text-center">
        <div class="max-w-3xl mx-auto">
          <h2 class="text-3xl md:text-4xl font-bold text-white mb-6">
            Besoin d'informations spécifiques ?
          </h2>
          <p class="text-xl text-green-100 mb-8">
            Téléchargez notre guide complet sur la beauté et la perte de poids avec les GLP-1
          </p>
          <a 
            href="/guide-beaute-perte-de-poids-glp1/" 
            class="inline-block bg-white text-green-600 font-bold py-4 px-8 rounded-lg hover:bg-green-50 transition-colors text-lg"
          >
            Télécharger le Guide Gratuit
          </a>
        </div>
      </div>
    </section>
  </main>
</BaseLayout>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
